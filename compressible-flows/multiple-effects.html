
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flows with multiple effects &#8212; Gas Dynamics notes</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bibliography" href="../zbibliography.html" />
    <link rel="prev" title="Flows with heat transfer (Rayleigh flows)" href="heat-transfer.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Gas Dynamics notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Gas Dynamics notes
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction and review
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/review-thermo.html">
   Review of thermodynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/control-volume-analysis.html">
   Control volume analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../intro/stagnation.html">
   Stagnation properties
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Compressible flows
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro-compressible-flow.html">
   Introduction to compressible flow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="isentropic.html">
   Isentropic, variable-area flows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="nozzles-part1.html">
   Nozzles (part I)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="normal-shocks.html">
   Normal shock waves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="oblique-shocks.html">
   Oblique shock waves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="prandtl-meyer.html">
   Prandtlâ€“Meyer flows
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="friction.html">
   Flows with friction (Fanno flows)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="heat-transfer.html">
   Flows with heat transfer (Rayleigh flows)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Flows with multiple effects
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../zbibliography.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/compressible-flows/multiple-effects.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/kyleniemeyer/gas-dynamics-notes"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/kyleniemeyer/gas-dynamics-notes/issues/new?title=Issue%20on%20page%20%2Fcompressible-flows/multiple-effects.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/kyleniemeyer/gas-dynamics-notes/edit/main/compressible-flows/multiple-effects.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/kyleniemeyer/gas-dynamics-notes/main?urlpath=tree/compressible-flows/multiple-effects.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flows-with-friction-and-area-change">
   Flows with friction and area change
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#isentropic-flow-in-converging-nozzle">
   Isentropic flow in converging nozzle
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#subsonic-flow-with-friction-in-constant-area-duct">
   Subsonic flow with friction in constant area duct
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flows-with-area-change-and-friction">
   Flows with area change and friction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sonic-location">
     Sonic location
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flows-with-heat-transfer-and-area-change">
   Flows with heat transfer and area change
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-heat-transfer-in-coverging-nozzle-with-shock">
     Example: heat transfer in coverging nozzle with shock
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="flows-with-multiple-effects">
<h1>Flows with multiple effects<a class="headerlink" href="#flows-with-multiple-effects" title="Permalink to this headline">Â¶</a></h1>
<p>This module covers how we can analyze compressible flows with multiple effects accelerating or decelerating the flow: area change, friction, and/or heat transfer (plus shocks!).</p>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">root_scalar</span>

<span class="c1"># Pint gives us some helpful unit conversion</span>
<span class="kn">from</span> <span class="nn">pint</span> <span class="kn">import</span> <span class="n">UnitRegistry</span>
<span class="n">ureg</span> <span class="o">=</span> <span class="n">UnitRegistry</span><span class="p">()</span>
<span class="n">Q_</span> <span class="o">=</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span> <span class="c1"># We will use this to construct quantities (value + unit)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># these lines are only for helping improve the display</span>
<span class="kn">import</span> <span class="nn">matplotlib_inline.backend_inline</span>
<span class="n">matplotlib_inline</span><span class="o">.</span><span class="n">backend_inline</span><span class="o">.</span><span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cm&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="flows-with-friction-and-area-change">
<h2>Flows with friction and area change<a class="headerlink" href="#flows-with-friction-and-area-change" title="Permalink to this headline">Â¶</a></h2>
<div class="figure align-default" id="fig-cv-friction-area">
<a class="bg-white mb-1 reference internal image-reference" href="../_images/cv-area-friction.png"><img alt="Control volume for flow with friction and area change" class="bg-white mb-1" src="../_images/cv-area-friction.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 9 </span><span class="caption-text">Differential control volume for adiabatic flow in a duct with varying area and friction.</span><a class="headerlink" href="#fig-cv-friction-area" title="Permalink to this image">Â¶</a></p>
</div>
<p><a class="reference internal" href="#fig-cv-friction-area"><span class="std std-numref">Figure 9</span></a> shows a control volume in a varying-area duct, where the flow starts out with velocity <span class="math notranslate nohighlight">\(V\)</span>, density <span class="math notranslate nohighlight">\(\rho\)</span>, and pressure <span class="math notranslate nohighlight">\(p\)</span>. The width of the differential control volume is <span class="math notranslate nohighlight">\(dx\)</span>, the cross-sectional area of the duct is <span class="math notranslate nohighlight">\(A\)</span>, and the wetted surface area is <span class="math notranslate nohighlight">\(A_s\)</span>. The friction force <span class="math notranslate nohighlight">\(F_f\)</span> is equivalent to the product of shear stress due to wall friction <span class="math notranslate nohighlight">\(\tau_f\)</span> and <span class="math notranslate nohighlight">\(A_s\)</span>.</p>
<p>First, we can apply conservation of mass to the control volume:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
\rho V A = (\rho + d\rho) (V + dV) (A + dA) \\
0 = \rho A dV + \rho V dA + A V d\rho
\end{gather*}\]</div>
<div class="math notranslate nohighlight" id="equation-eq-continuity">
<span class="eqno">(69)<a class="headerlink" href="#equation-eq-continuity" title="Permalink to this equation">Â¶</a></span>\[
0 = \frac{dV}{V} + \frac{dA}{A} + \frac{d\rho}{\rho}
\]</div>
<p>Next, conservation of momentum:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
\sum F_x = \dot{m} \left( V_{\text{out}, x} - V_{\text{in}, x} \right) \\
p A + \left( p + \frac{dp}{2} \right) dA - (p + dp) (A + dA) - \tau_f A_s = (\rho A V)(V + dV - V) \\
-A dp - \frac{1}{2} \rho V^2 \frac{f A_s}{4} = \rho A V dV \\
dp + \frac{1}{2} V^2 \frac{f dx}{D} + p V dV = 0 \;,
\end{gather*}\]</div>
<p>where <span class="math notranslate nohighlight">\( f \equiv 4 \tau_f / \left( \frac{1}{2} \rho V^2 \right) \)</span> is the Darcy friction factor, and for a circular duct <span class="math notranslate nohighlight">\( A_s = \pi D dx = 4 A dx / D \)</span>.
We can then obtain</p>
<div class="math notranslate nohighlight">
\[
\frac{d\rho}{\rho} + \frac{dT}{T} + \gamma M^2 \frac{dV}{V} + \frac{1}{2} \gamma M^2 \frac{f dx}{D} = 0 \;.
\]</div>
<p>We can eliminate <span class="math notranslate nohighlight">\( d\rho / \rho \)</span> using Equation <a class="reference internal" href="#equation-eq-continuity">(69)</a>:</p>
<div class="math notranslate nohighlight">
\[
- \left( \frac{dV}{V} + \frac{dA}{A} \right) + \frac{dT}{T} + \gamma M^2 \frac{dV}{V} + \frac{1}{2} \gamma M^2 \frac{f dx}{D} = 0 \;.
\]</div>
<p>Next, letâ€™s introduce the definition of Mach number:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
V = M a = M \sqrt{\gamma R T} \\
dV = dM \sqrt{\gamma R T} + \frac{M \sqrt{\gamma R}}{2 \sqrt{T}} dT \\
\frac{dV}{V} = \frac{dM}{M} + \frac{1}{2} \frac{dT}{T} \;,
\end{gather*}\]</div>
<p>which we can use to eliminate <span class="math notranslate nohighlight">\( dV / V \)</span>.
Finally, since the flow is adiabatic, we can use the fact that stagnation enthalpy remains constant:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
T_t = \text{constant} = T \left( 1 + \frac{\gamma - 1}{2} M^2 \right) \\
\frac{dT}{T} + \frac{d \left( 1 + \frac{\gamma - 1}{2} M^2 \right)}{\left( 1 + \frac{\gamma - 1}{2} M^2 \right)} = 0 \\
\frac{dT}{T} = - \frac{ (\gamma - 1) M dM}{1 + \frac{\gamma - 1}{2} M^2} \;,
\end{gather*}\]</div>
<p>which gives us an expression for <span class="math notranslate nohighlight">\( dT / T \)</span>.
Eliminating <span class="math notranslate nohighlight">\( dT / T \)</span> and <span class="math notranslate nohighlight">\( dV / V \)</span> leads to</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{2} \gamma M^2 \frac{f dx}{D} = \frac{dA}{A} + \frac{2(1 - M^2)}{2 + (\gamma-1) M^2} \frac{dM}{M} \;.
\]</div>
<p>Finally, we can divide by <span class="math notranslate nohighlight">\(dx\)</span>, and obtain a differential equation that describes how Mach number changes in a compressible flow due to the effects of both area change (via <span class="math notranslate nohighlight">\(dA/dx\)</span>) and friction:</p>
<div class="math notranslate nohighlight" id="equation-eq-friction-area">
<span class="eqno">(70)<a class="headerlink" href="#equation-eq-friction-area" title="Permalink to this equation">Â¶</a></span>\[
\frac{1}{2} \gamma M^2 \frac{f}{D} = \frac{1}{A} \frac{dA}{dx} + \frac{2 (1-M^2)}{M \left[ 2 + (\gamma-1) M^2 \right]} \frac{dM}{dx} \;.
\]</div>
<p>Unfortunately, this is not something we can usually integrate analytically to get an exact solution (except for the specific cases of isentropic flow and constant-area Fanno flow).
Instead, weâ€™ll need to use integration methods to obtain numerical solutions.</p>
<p>First, letâ€™s consider the cases where we <em>do</em> have exact solutions, so we can compare our numerical results, and then we will look at the general case of combined friction and varying-area effects.</p>
</div>
<div class="section" id="isentropic-flow-in-converging-nozzle">
<h2>Isentropic flow in converging nozzle<a class="headerlink" href="#isentropic-flow-in-converging-nozzle" title="Permalink to this headline">Â¶</a></h2>
<p>First, consider air flowing isentropically (and so <span class="math notranslate nohighlight">\(f = 0\)</span>) in a conically shaped converging nozzle,
with length 10 cm, initial area of 50 cm<span class="math notranslate nohighlight">\(^2\)</span>,
outlet area of 40 cm<span class="math notranslate nohighlight">\(^2\)</span>. The inflow temperature is 300 K and velocity is 100 m/s.</p>
<p>Find the outlet Mach number and compare against the exact solution.</p>
<p>For a conical nozzle, we can express the area using</p>
<div class="math notranslate nohighlight">
\[
A(x) = \frac{\pi}{4} D(x)^2 = \frac{\pi}{4} \left( D_i + \frac{D_o - D_i}{L} \right)^2
\]</div>
<p>Then, the area term is</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{A(x)} \frac{dA}{dx} = \frac{2}{D(x)} \frac{dD}{dx} = \frac{2 \frac{D_o - D_i}{L}}{D(x)} \;,
\]</div>
<p>where the diameter is expressed as <span class="math notranslate nohighlight">\( D(x) = D_i + (D_o - D_i) \frac{x}{L} \)</span>.</p>
<p>Substituting this into Equation <a class="reference internal" href="#equation-eq-friction-area">(70)</a>, since <span class="math notranslate nohighlight">\(f = 0\)</span>, we get</p>
<div class="math notranslate nohighlight">
\[
\frac{dM}{dx} = F(x,M) = - \left[ \frac{(D_o - D_i) / L}{D(x)} \right] \frac{2 + (\gamma-1)M^2}{1 - M^2} M \;,
\]</div>
<p>which we can integrate over <span class="math notranslate nohighlight">\(x = [0, L]\)</span> with the initial condition <span class="math notranslate nohighlight">\( M(x=0) = M_i = V_i / a_i \)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.4</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">287</span><span class="p">,</span> <span class="s1">&#39;J/(kg*K)&#39;</span><span class="p">)</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">area_in</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;cm^2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m^2&#39;</span><span class="p">)</span>
<span class="n">area_out</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="s1">&#39;cm^2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m^2&#39;</span><span class="p">)</span>

<span class="n">temperature_in</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">)</span>
<span class="n">velocity_in</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diameter_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area_in</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">diameter_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area_out</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

<span class="n">speed_sound_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">R</span> <span class="o">*</span> <span class="n">temperature_in</span><span class="p">)</span>
<span class="n">mach_in</span> <span class="o">=</span> <span class="p">(</span><span class="n">velocity_in</span> <span class="o">/</span> <span class="n">speed_sound_in</span><span class="p">)</span><span class="o">.</span><span class="n">to_base_units</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;M_in = </span><span class="si">{</span><span class="n">mach_in</span><span class="si">:</span><span class="s1"> .4f~P</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>M_in = 0.2880
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dMdx_isentropic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">D_in</span><span class="p">,</span> <span class="n">D_out</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Equation for dM/dx in isentropic flow&#39;&#39;&#39;</span>
    <span class="c1"># conical nozzle</span>
    <span class="n">diameter</span> <span class="o">=</span> <span class="n">D_in</span> <span class="o">+</span> <span class="p">(</span><span class="n">D_out</span> <span class="o">-</span> <span class="n">D_in</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">length</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">M</span> <span class="o">*</span> <span class="p">((</span><span class="n">D_out</span> <span class="o">-</span> <span class="n">D_in</span><span class="p">)</span> <span class="o">/</span> <span class="n">length</span> <span class="o">/</span> <span class="n">diameter</span><span class="p">)</span> <span class="o">*</span>
        <span class="p">((</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># integrate from x = 0 to L, using maximum step size of 1 cm</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_isentropic</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">],</span> <span class="p">[</span><span class="n">mach_in</span><span class="o">.</span><span class="n">magnitude</span><span class="p">],</span> 
    <span class="n">max_step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">diameter_in</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> 
          <span class="n">diameter_out</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">length</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
         <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mach number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&#39;isentropic-numerical.png&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/multiple-effects_9_0.png" src="../_images/multiple-effects_9_0.png" />
</div>
</div>
<p>Next, we can compare this against the exact solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare against exact solution</span>

<span class="n">mach_out</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;M_out (numerical): </span><span class="si">{</span><span class="n">mach_out</span><span class="si">:</span><span class="s1"> .4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">isentropic_area_ratio</span><span class="p">(</span><span class="n">mach2</span><span class="p">,</span> <span class="n">mach1</span><span class="p">,</span> <span class="n">area_ratio</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Function for isentropic area ratio equation, solving for M2&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">area_ratio</span> <span class="o">-</span> <span class="p">(</span><span class="n">mach1</span> <span class="o">/</span> <span class="n">mach2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">mach2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">mach1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span><span class="o">**</span><span class="p">((</span><span class="n">gamma</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
        <span class="p">)</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span>
    <span class="n">isentropic_area_ratio</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mach_in</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="p">(</span><span class="n">area_out</span><span class="o">/</span><span class="n">area_in</span><span class="p">)</span><span class="o">.</span><span class="n">to_base_units</span><span class="p">()</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
    <span class="p">)</span>
<span class="n">mach_out_exact</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">root</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;M_out (exact) = </span><span class="si">{</span><span class="n">mach_out_exact</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mach_out_exact</span><span class="o">-</span><span class="n">mach_out</span><span class="p">)</span><span class="o">/</span><span class="n">mach_out_exact</span><span class="si">:</span><span class="s1"> .3e</span><span class="si">}</span><span class="s1"> %&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>M_out (numerical):  0.3719
M_out (exact) = 0.3719
Error:  1.206e-10 %
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="subsonic-flow-with-friction-in-constant-area-duct">
<h2>Subsonic flow with friction in constant area duct<a class="headerlink" href="#subsonic-flow-with-friction-in-constant-area-duct" title="Permalink to this headline">Â¶</a></h2>
<p>Next, consider air flow in a constant area duct with friction. (This is Fanno flow.)
The initial Mach number is <span class="math notranslate nohighlight">\(M_i = 0.6\)</span>, the duct length is 45 cm, the diameter is 3 cm, and the friction factor is 0.02.</p>
<p>Find the outlet Mach number, and compare against the exact solution.</p>
<p>Since the area is constant, <span class="math notranslate nohighlight">\( \frac{dA}{dx} = 0\)</span>, and Equation <a class="reference internal" href="#equation-eq-friction-area">(70)</a> simplifies to</p>
<div class="math notranslate nohighlight">
\[
\frac{dM}{dx} = F(x,M) = \frac{\gamma M^3 \left[ 2 + (\gamma-1) M^2 \right]}{4 (1-M^2)} \frac{f}{D} \;,
\]</div>
<p>which we can integrate over <span class="math notranslate nohighlight">\(x = [0, L]\)</span> with initial condition <span class="math notranslate nohighlight">\( M(x=0) = M_i \)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.4</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">287</span><span class="p">,</span> <span class="s1">&#39;J/(kg*K)&#39;</span><span class="p">)</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">)</span>
<span class="n">diameter</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">)</span>
<span class="n">friction_factor</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">mach_in</span> <span class="o">=</span> <span class="mf">0.60</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dMdx_fanno</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Equation for dM/dx in Fanno flow&#39;&#39;&#39;</span>    
    <span class="k">return</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">M</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span> <span class="o">/</span> <span class="n">D</span><span class="p">)</span> <span class="o">/</span>
        <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># integrate from x = 0 to L, using maximum step size of 3 cm</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_fanno</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">],</span> <span class="p">[</span><span class="n">mach_in</span><span class="p">],</span> 
    <span class="n">max_step</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">friction_factor</span><span class="p">,</span> <span class="n">diameter</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">mach_out</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.60</span><span class="p">,</span> <span class="mf">0.72</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mach number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&#39;numerical-fanno.png&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/multiple-effects_15_0.png" src="../_images/multiple-effects_15_0.png" />
</div>
</div>
<p>We can compare this numerical solution to the exact solution for Fanno flow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare with exact solution</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;M_out (numerical) = </span><span class="si">{</span><span class="n">mach_out</span><span class="si">:</span><span class="s1"> .4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fanno_distance</span><span class="p">(</span><span class="n">mach_2</span><span class="p">,</span> <span class="n">mach_1</span><span class="p">,</span> <span class="n">delta_x</span><span class="p">,</span> <span class="n">friction</span><span class="p">,</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Function for Fanno flow, solving for M2&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">friction</span> <span class="o">*</span> <span class="n">delta_x</span> <span class="o">/</span> <span class="n">diameter</span><span class="p">)</span> <span class="o">-</span>  <span class="p">(((</span><span class="n">gamma</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="p">))</span> <span class="o">*</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">mach_2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">mach_1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span>
            <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">mach_2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">mach_1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span>
            <span class="p">(</span><span class="n">gamma</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mach_2</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">mach_1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

<span class="n">root</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span>
    <span class="n">fanno_distance</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">mach_in</span><span class="p">,</span> <span class="n">length</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">friction_factor</span><span class="p">,</span> 
          <span class="n">diameter</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">gamma</span><span class="p">)</span>
          <span class="p">)</span>
<span class="n">mach_out_exact</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">root</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;M_out (exact) = </span><span class="si">{</span><span class="n">mach_out_exact</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error: </span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mach_out_exact</span><span class="o">-</span><span class="n">mach_out</span><span class="p">)</span><span class="o">/</span><span class="n">mach_out_exact</span><span class="si">:</span><span class="s1"> .4e</span><span class="si">}</span><span class="s1"> %&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>M_out (numerical) =  0.7093
M_out (exact) = 0.7093
Error:  3.1377e-09 %
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="flows-with-area-change-and-friction">
<h2>Flows with area change and friction<a class="headerlink" href="#flows-with-area-change-and-friction" title="Permalink to this headline">Â¶</a></h2>
<p>When the flow encounters both area change and friction, we need to solve the full version of Equation <a class="reference internal" href="#equation-eq-friction-area">(70)</a>, rearranged for convenience:</p>
<div class="math notranslate nohighlight" id="equation-eq-area-friction-func">
<span class="eqno">(71)<a class="headerlink" href="#equation-eq-area-friction-func" title="Permalink to this equation">Â¶</a></span>\[
\frac{dM}{dx} = F(x,M) = \left\{ \frac{M \left[ 2 + (\gamma - 1)M^2 \right]}{2} \right\} \left\{ \frac{ -\frac{1}{A} \frac{dA}{dx} + \frac{1}{2} \gamma M^2 \frac{f}{D}}{1 - M^2} \right\}
\]</div>
<p>We can integrate this in theory, but if we want to analyze converging-diverging nozzles that are choked, as <span class="math notranslate nohighlight">\( M \rightarrow 1 \)</span> at some location, then <span class="math notranslate nohighlight">\( \frac{dM}{dx} \rightarrow \infty \)</span>. So, we need some special treatment to handle this singularity.</p>
<p>The method of Beans <span id="id1">[<a class="reference internal" href="../zbibliography.html#id5">Bea70</a>]</span> uses lâ€™HÃ´pitalâ€™s rule to get a finite value for <span class="math notranslate nohighlight">\( \frac{dM}{dx}\)</span> as the Mach number approches one.
To evaluate the derivative at this limit, we can take the derivative of the numerator and denominator at the limit, focusing on the term</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\lim_{M \rightarrow 1} \left[ \frac{-\frac{1}{A} \frac{dA}{dx} + \frac{1}{2} \gamma M^2 \frac{f}{D}}{1 - M^2} \right] &amp;= \lim_{M \rightarrow 1} \left\{ \frac{\frac{d}{dx} \left( -\frac{1}{A} \frac{dA}{dx} + \frac{1}{2} \gamma M^2 \frac{f}{D} \right)}{-2 M \frac{dM}{dx}} \right\} \\
&amp;= \frac{\frac{d}{dx} \left[ -\frac{1}{A} \left( \frac{dA}{dx} \right) \right]_{M \rightarrow 1} + \frac{1}{2} \gamma \frac{d}{dx} \left(\frac{f}{D} \right)_{M \rightarrow 1} + \gamma \left( \frac{f}{D} \right)_{M \rightarrow 1} \left( \frac{dM}{dx} \right)_{M \rightarrow 1}}{-2 \left( \frac{dM}{dx} \right)_{M \rightarrow 1}} \\
\end{align*}\]</div>
<p>Then, looking at the whole derivative as <span class="math notranslate nohighlight">\( M \rightarrow 1 \)</span>,</p>
<div class="math notranslate nohighlight">
\[
\left( \frac{dM}{dx} \right)_{M \rightarrow 1} = \left( \frac{\gamma+1}{2} \right) \left\{ \frac{\frac{d}{dx} \left[ -\frac{1}{A} \left( \frac{dA}{dx} \right) \right]_{M \rightarrow 1} + \frac{1}{2} \gamma \frac{d}{dx} \left(\frac{f}{D} \right)_{M \rightarrow 1} + \gamma \left( \frac{f}{D} \right) \left( \frac{dM}{dx} \right)_{M \rightarrow 1}}{-2 \left( \frac{dM}{dx} \right)_{M \rightarrow 1}} \right\} \;,
\]</div>
<p>which we can rearrange to get</p>
<div class="math notranslate nohighlight" id="equation-eq-quadratic-dmdx">
<span class="eqno">(72)<a class="headerlink" href="#equation-eq-quadratic-dmdx" title="Permalink to this equation">Â¶</a></span>\[
\frac{4}{\gamma+1} \left( \frac{dM}{dx} \right)_{M \rightarrow 1}^2 + \gamma \left( \frac{f}{D} \right)_{M \rightarrow 1} \left( \frac{dM}{dx} \right)_{M \rightarrow 1} - \frac{d}{dx} \left( \frac{1}{A} \frac{dA}{dx} \right)_{M \rightarrow 1} + \frac{\gamma}{2}\frac{d}{dx} \left( \frac{f}{D} \right)_{M \rightarrow 1} = 0 \;.
\]</div>
<p>This is a quadratic equation for the derivative <span class="math notranslate nohighlight">\( dM/dx \)</span> as the Mach number approaches one.
It has two roots at the sonic point, one negative and one positive:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( \frac{dM}{dx} &gt; 0 \)</span> for accelerating flow, where <span class="math notranslate nohighlight">\( \frac{dA}{dx} &lt; 0 \)</span> for subsonic flow and <span class="math notranslate nohighlight">\( \frac{dA}{dx} &gt; 0 \)</span> for supersonic flow; and</p></li>
<li><p><span class="math notranslate nohighlight">\( \frac{dM}{dx} &lt; 0 \)</span> for decelerating flow, where <span class="math notranslate nohighlight">\( \frac{dA}{dx} &gt; 0 \)</span> for subsonic flow and <span class="math notranslate nohighlight">\( \frac{dA}{dx} &lt; 0 \)</span> for supersonic flow</p></li>
</ul>
<div class="section" id="sonic-location">
<h3>Sonic location<a class="headerlink" href="#sonic-location" title="Permalink to this headline">Â¶</a></h3>
<p>To apply the appropriate solution, we need to find the location of the sonic point,
found with</p>
<div class="math notranslate nohighlight" id="equation-eq-sonic-point">
<span class="eqno">(73)<a class="headerlink" href="#equation-eq-sonic-point" title="Permalink to this equation">Â¶</a></span>\[
\left( -\frac{1}{A} \frac{dA}{dx} + \frac{1}{2} \gamma M^2 \frac{f}{D} \right)_{M \rightarrow 1} \rightarrow 0 \;.
\]</div>
<p>To find the specific location, we need to consider a specific nozzle shape;
letâ€™s focus on a symmetrical nozzle with circular cross section, following the formula</p>
<div class="math notranslate nohighlight" id="equation-eq-diameter-symmetric">
<span class="eqno">(74)<a class="headerlink" href="#equation-eq-diameter-symmetric" title="Permalink to this equation">Â¶</a></span>\[
D(x) = 2 \left[ 1 + \frac{1}{2} \cos \left( \pi \frac{x}{L} \right) \right] D_t \;,
\]</div>
<p>where the diameter is <span class="math notranslate nohighlight">\(3 D_t\)</span> at <span class="math notranslate nohighlight">\( x = 0 \)</span>, <span class="math notranslate nohighlight">\(D_t\)</span> at <span class="math notranslate nohighlight">\(x=L\)</span>, and <span class="math notranslate nohighlight">\(3 D_t\)</span> at <span class="math notranslate nohighlight">\(x = 2L\)</span>.
For a circular nozzle, <span class="math notranslate nohighlight">\( \frac{1}{A} \frac{dA}{dx} = \frac{2}{D} \frac{dD}{dx} \)</span>.</p>
<p>Applying the specifics of this nozzle to Equation <a class="reference internal" href="#equation-eq-sonic-point">(73)</a>:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
\left( \frac{2}{D} \frac{dD}{dx} \right)_{M \rightarrow 1} = \left( \frac{\gamma}{2} \frac{f}{D} \right)_{M \rightarrow 1} \\
\left[ \frac{2}{D(x)} \frac{-\pi D_t}{L} \sin \left( \frac{\pi x}{L} \right) \right]_{M \rightarrow 1} = \left( \frac{\gamma}{2} \frac{f}{D(x)} \right)_{M \rightarrow 1} \\
\sin \left( \frac{\pi x_{\text{sp}}}{L} \right) = - \frac{\gamma f L}{4 \pi D_t} \\
\left( \frac{x}{L} \right)_{\text{sp}} = - \frac{1}{\pi} \sin^{-1} \left( \frac{\gamma f L}{4 \pi D_t} \right)
\end{gather*}\]</div>
<p>For a case where <span class="math notranslate nohighlight">\(\gamma = 1.4\)</span>, <span class="math notranslate nohighlight">\(f = 0.4\)</span>, and <span class="math notranslate nohighlight">\(L = 2 D_t\)</span>, we can calculate the sonic location:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.4</span>
<span class="n">f</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">f</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
<span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">x_L_sp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">angle</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(x/L) @ sonic = </span><span class="si">{</span><span class="n">x_L_sp</span><span class="si">:</span><span class="s1"> .4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(x/L) @ sonic =  1.0284
</pre></div>
</div>
</div>
</div>
<p>(This does require some careful calculation to get the right value.)</p>
<p>Now, with the sonic location identified, calculating the Mach number distribution throughout the nozzle requires solving <strong>two</strong> initial value problems: from the sonic point backwards to the inlet, and from the sonic point forwards to the outlet. For points at/near the sonic point, we can use Equation <a class="reference internal" href="#equation-eq-quadratic-dmdx">(72)</a> to find <span class="math notranslate nohighlight">\(dM/dx\)</span>.</p>
<p>Letâ€™s continue the case from before: air flowing through a symmetrical converging-diverging nozzle with a circular cross section, with the diameter given by Equation <a class="reference internal" href="#equation-eq-diameter-symmetric">(74)</a>. The nozzle length is <span class="math notranslate nohighlight">\( L = 2 D_t \)</span> and friction factor is <span class="math notranslate nohighlight">\( f = 0.4 \)</span> (this is very large).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for solving quadratic equation at M = 1</span>
<span class="n">Dsp</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x_L_sp</span><span class="p">))</span> <span class="c1"># * Dt</span>
<span class="n">dD_dx_sp</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x_L_sp</span><span class="p">)</span> <span class="c1"># *Dt/L</span>
<span class="n">d2D_dx2_sp</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x_L_sp</span><span class="p">)</span> <span class="c1"># * Dt/L^2</span>

<span class="n">a</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="n">Dsp</span>
<span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">d2D_dx2_sp</span><span class="o">/</span><span class="n">Dsp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">dD_dx_sp</span><span class="o">/</span><span class="n">Dsp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dD_dx_sp</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Dsp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># dM/d(x/L) at sonic point</span>
<span class="n">roots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
<span class="c1"># take the positive root for accelerating flow</span>
<span class="n">dM_dxL_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">area_function</span><span class="p">(</span><span class="n">x_L</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Function for (1/A)*(dA/dx) using x/L&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x_L</span><span class="p">)</span> <span class="o">/</span> 
            <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x_L</span><span class="p">))</span>
        <span class="p">)</span>

<span class="k">def</span> <span class="nf">diameter_function</span><span class="p">(</span><span class="n">x_L</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Function for nondimensional D&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x_L</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">dMdx_friction_area</span><span class="p">(</span><span class="n">x_L</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">area_func</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">diameter_func</span><span class="p">,</span> <span class="n">dM_dxL_sp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;dM/dx for flows with friction and area change.</span>
<span class="sd">    </span>
<span class="sd">    area_func is a function for (1/A)*(dA/dx)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># when in neighborhood of M = 1, use special version of dM/dx</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">M</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dM_dxL_sp</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="mf">0.5</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="o">-</span><span class="n">area_func</span><span class="p">(</span><span class="n">x_L</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">gamma</span><span class="o">*</span><span class="n">M</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="o">/</span><span class="n">diameter_func</span><span class="p">(</span><span class="n">x_L</span><span class="p">)</span>
                <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># integrate x/L from sonic point to 0</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(([</span><span class="n">x_L_sp</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="n">sol_sub</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_friction_area</span><span class="p">,</span> <span class="p">[</span><span class="n">x_L_sp</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> 
    <span class="n">t_eval</span><span class="o">=</span><span class="n">x_vals</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">area_function</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">diameter_function</span><span class="p">,</span> <span class="n">dM_dxL_sp</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># integrate x/L from sonic point to 2</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(([</span><span class="n">x_L_sp</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">2.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)))</span>

<span class="n">sol_super</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_friction_area</span><span class="p">,</span> <span class="p">[</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> 
    <span class="n">t_eval</span><span class="o">=</span><span class="n">x_vals</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">area_function</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">diameter_function</span><span class="p">,</span> <span class="n">dM_dxL_sp</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare with isentropic</span>
<span class="n">f</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">x_L_sp</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># for solving quadratic equation at M = 1</span>
<span class="n">Dsp</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x_L_sp</span><span class="p">))</span> <span class="c1"># * Dt</span>
<span class="n">dD_dx_sp</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x_L_sp</span><span class="p">)</span> <span class="c1"># *Dt/L</span>
<span class="n">d2D_dx2_sp</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x_L_sp</span><span class="p">)</span> <span class="c1"># * Dt/L^2</span>

<span class="n">a</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">f</span> <span class="o">/</span> <span class="n">Dsp</span>
<span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">d2D_dx2_sp</span><span class="o">/</span><span class="n">Dsp</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">dD_dx_sp</span><span class="o">/</span><span class="n">Dsp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">dD_dx_sp</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Dsp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># dM/d(x/L) at sonic point</span>
<span class="n">roots</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span>
<span class="c1"># take the positive root for accelerating flow</span>
<span class="n">dM_dxL_sp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span>


<span class="c1"># integrate x/L from sonic point to 0</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="n">sol_sub_isen</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_friction_area</span><span class="p">,</span> <span class="p">[</span><span class="n">x_L_sp</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> 
    <span class="n">t_eval</span><span class="o">=</span><span class="n">x_vals</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">area_function</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">diameter_function</span><span class="p">,</span> <span class="n">dM_dxL_sp</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># integrate x/L from sonic point to 2</span>
<span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>

<span class="n">sol_super_isen</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_friction_area</span><span class="p">,</span> <span class="p">[</span><span class="n">x_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> 
    <span class="n">t_eval</span><span class="o">=</span><span class="n">x_vals</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">area_function</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">diameter_function</span><span class="p">,</span> <span class="n">dM_dxL_sp</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_sub</span><span class="o">.</span><span class="n">t</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sol_super</span><span class="o">.</span><span class="n">t</span><span class="p">)),</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_sub</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sol_super</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;with friction&#39;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_sub_isen</span><span class="o">.</span><span class="n">t</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sol_super_isen</span><span class="o">.</span><span class="n">t</span><span class="p">)),</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_sub_isen</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sol_super_isen</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;isentropic&#39;</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x / L$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mach number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&#39;area-friction.png&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/multiple-effects_25_0.png" src="../_images/multiple-effects_25_0.png" />
</div>
</div>
<p>We can see that the presence of friction starts to significantly alter the flow in the supersonic region, decelerating the flow from the isentropic solution and even causing the Mach number to begin decreasing near the exit. This is an extreme case, due to the high friction factor.</p>
</div>
</div>
<div class="section" id="flows-with-heat-transfer-and-area-change">
<h2>Flows with heat transfer and area change<a class="headerlink" href="#flows-with-heat-transfer-and-area-change" title="Permalink to this headline">Â¶</a></h2>
<div class="figure align-default" id="fig-cv-heat-area">
<a class="bg-white mb-1 reference internal image-reference" href="../_images/cv-area-heat.png"><img alt="Control volume for flow with heat transfer and area change" class="bg-white mb-1" src="../_images/cv-area-heat.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 10 </span><span class="caption-text">Differential control volume for frictionless flow in a duct with varying area and heat transfer.</span><a class="headerlink" href="#fig-cv-heat-area" title="Permalink to this image">Â¶</a></p>
</div>
<p><a class="reference internal" href="#fig-cv-heat-area"><span class="std std-numref">Figure 10</span></a> shows a control volume in a varying-area duct, where the flow starts out with velocity <span class="math notranslate nohighlight">\(V\)</span>, density <span class="math notranslate nohighlight">\(\rho\)</span>, and pressure <span class="math notranslate nohighlight">\(p\)</span>. The width of the differential control volume is <span class="math notranslate nohighlight">\(dx\)</span>, the cross-sectional area of the duct is <span class="math notranslate nohighlight">\(A\)</span>, and the flow experiences heat transfer <span class="math notranslate nohighlight">\( \delta q \)</span>.</p>
<p>Applying conservation of mass, momentum, and energy to the control volume, we get</p>
<div class="math notranslate nohighlight" id="equation-eq-heat-area-continuity">
<span class="eqno">(75)<a class="headerlink" href="#equation-eq-heat-area-continuity" title="Permalink to this equation">Â¶</a></span>\[
\frac{d\rho}{\rho} + \frac{dA}{A} + \frac{dV}{V} = 0
\]</div>
<div class="math notranslate nohighlight" id="equation-eq-heat-area-momentum">
<span class="eqno">(76)<a class="headerlink" href="#equation-eq-heat-area-momentum" title="Permalink to this equation">Â¶</a></span>\[
dp + \rho V dV = 0
\]</div>
<div class="math notranslate nohighlight" id="equation-eq-heat-area-energy">
<span class="eqno">(77)<a class="headerlink" href="#equation-eq-heat-area-energy" title="Permalink to this equation">Â¶</a></span>\[
\delta q = c_p d T_t \;,
\]</div>
<p>and we also can express a differential form of the ideal gas law:</p>
<div class="math notranslate nohighlight">
\[
\frac{dp}{p} = \frac{d\rho}{\rho} + \frac{dT}{T}
\]</div>
<p>We can eliminate <span class="math notranslate nohighlight">\( \frac{dp}{p} \)</span> by taking Equation <a class="reference internal" href="#equation-eq-heat-area-momentum">(76)</a> and dividing by <span class="math notranslate nohighlight">\(p\)</span>, where we get</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
\frac{dp}{p} + \frac{\rho}{p} V dV = 0 \\
\rightarrow \frac{d\rho}{\rho} + \frac{dT}{T} + \frac{\rho}{p} V dV = 0 \;.
\end{gather*}\]</div>
<p>Next, incorporate Equation <a class="reference internal" href="#equation-eq-heat-area-continuity">(75)</a> to eliminate <span class="math notranslate nohighlight">\( \frac{d\rho}{\rho} \)</span> and use the ideal gas law expression</p>
<div class="math notranslate nohighlight">
\[
\frac{\rho}{p} V dV = \frac{\rho}{p} V^2 \frac{dV}{V} = \frac{1}{RT} M^2 \gamma R T \frac{dV}{V} = \gamma M^2 \frac{dV}{V}
\]</div>
<p>to get</p>
<div class="math notranslate nohighlight">
\[
- \left( \frac{dA}{A} + \frac{dV}{V} \right) + \frac{dT}{T} + \gamma M^2 \frac{dV}{V} = 0 \;.
\]</div>
<p>We can use the logarithmic derivative of the Mach number expression to eliminate <span class="math notranslate nohighlight">\( \frac{dV}{V} \)</span>:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
V = M \sqrt{ \gamma R T } \\
dV = dM \sqrt{\gamma R T} + dT \frac{1}{2} \frac{1}{\sqrt{T}} M \sqrt{\gamma R} \\
\frac{dV}{V} = \frac{dM}{M} + \frac{1}{2} \frac{dT}{T}
\end{gather*}\]</div>
<p>and get</p>
<div class="math notranslate nohighlight">
\[
-\frac{dA}{A} + \frac{dM}{M} \left(\gamma M^2 - 1 \right) + \frac{dT}{T} \left( \frac{\gamma M^2 + 1}{2} \right) = 0 \;.
\]</div>
<p>To eliminate <span class="math notranslate nohighlight">\(\frac{dT}{T}\)</span>, we can look at the stagnation temperature relationship:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
T_t = T \left( 1 + \frac{\gamma-1}{2} M^2 \right) \\
dT_t = dT \left( 1 + \frac{\gamma-1}{2} M^2 \right) + T (\gamma-1) M dM \\
\frac{dT_t}{T} = \left( 1 + \frac{\gamma-1}{2} M^2 \right) \frac{dT}{T} + (\gamma-1) M^2 \frac{dM}{M} \;,
\end{gather*}\]</div>
<p>but we have from Equation <a class="reference internal" href="#equation-eq-heat-area-energy">(77)</a> that <span class="math notranslate nohighlight">\( dT_t = \delta q / c_p \)</span>, so</p>
<div class="math notranslate nohighlight">
\[
\frac{dT}{T} = \left( 1 + \frac{\gamma-1}{2} M^2 \right)^{-1} \left[ \frac{\delta q}{c_p T} - M^2 (\gamma-1) \frac{dM}{M} \right] \;,
\]</div>
<p>which we can substitute into the above expression to get</p>
<div class="math notranslate nohighlight">
\[
-\frac{dA}{A} + \frac{ \gamma M^2 + 1}{2 \left( 1 + \frac{\gamma-1}{2} M^2 \right)} \frac{\delta q}{c_p T} + \frac{M^2 - 1}{1 + \frac{\gamma-1}{2} M^2} \frac{dM}{M} = 0 \;.
\]</div>
<p>Rearranging and dividing by <span class="math notranslate nohighlight">\(dx\)</span>, we can get an ordinary differential equation for solving for Mach number:</p>
<div class="math notranslate nohighlight" id="equation-eq-heat-transfer-area">
<span class="eqno">(78)<a class="headerlink" href="#equation-eq-heat-transfer-area" title="Permalink to this equation">Â¶</a></span>\[
\frac{dM}{dx} = \frac{M}{1 - M^2} \left[ -\left(1 + \frac{\gamma-1}{2} M^2 \right) \frac{1}{A} \frac{dA}{dx} + \frac{1 + \gamma M^2}{2} \left( \frac{1}{c_p T} \frac{\delta q}{dx} \right) \right]
\]</div>
<p>To integrate <span class="math notranslate nohighlight">\(M(x)\)</span>, we need to know how the area changes with position and the rate that heat transfer occurs with distance.</p>
<div class="section" id="example-heat-transfer-in-coverging-nozzle-with-shock">
<h3>Example: heat transfer in coverging nozzle with shock<a class="headerlink" href="#example-heat-transfer-in-coverging-nozzle-with-shock" title="Permalink to this headline">Â¶</a></h3>
<p>As an example, consider air flow in a diverging conical nozzle of length 10 cm, where the diameter grows linearly with distance from 2 cm to 5 cm.
The air enters the nozzle at a Mach number of 3 with a stagnation temperature of 300 K.
Heat is added at a rate such that <span class="math notranslate nohighlight">\( \frac{dT_t}{dx} \)</span> = 100 K/m.
Due to the pressure at the exit, there is a normal shock wave halfway down the nozzle.</p>
<p>Thanks to our relationship between heat transfer and stagnation temperature, <span class="math notranslate nohighlight">\(\delta q = c_p d T_t\)</span>, and our prior stagnation relationship for temperature, we can rewrite Equation <a class="reference internal" href="#equation-eq-heat-transfer-area">(78)</a> for this problem:</p>
<div class="math notranslate nohighlight">
\[
\frac{dM}{dx} = \frac{M \left[ 2 + (\gamma-1) M^2 \right]}{2 (1-M^2)} \left[ -\frac{1}{A} \frac{dA}{dx} + \frac{1+\gamma M^2}{2} \left( \frac{1}{T_t} \frac{dT_t}{dt} \right) \right] \;.
\]</div>
<p>The nozzle diameter varies linearly with length:</p>
<div class="math notranslate nohighlight">
\[
D(x) = D_i + (D_e - D_i) \frac{x}{L} \;,
\]</div>
<p>and so we can express the area and rate of change of area as</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{gather*}
A(x) = \frac{\pi}{4} D(x)^2 = \frac{\pi}{4} \left[ D_i + (D_e - D_i) \frac{x}{L} \right]^2 \\
\rightarrow \frac{1}{A(x)} \frac{dA}{dx} = \frac{2}{D(x)} \frac{dD}{dx} = 2 \frac{\frac{D_e-D_i}{L}}{D(x)} = \frac{2 \alpha}{D(x} 
\end{gather*}\]</div>
<p>where <span class="math notranslate nohighlight">\( \alpha = (D_e - D_i) / L = 0.3 \)</span> and <span class="math notranslate nohighlight">\( D(x) = D_i + \alpha x \)</span>.
This leads to a specific <span class="math notranslate nohighlight">\(dM / dx\)</span> for this problem:</p>
<div class="math notranslate nohighlight">
\[
\frac{dM}{dx} = \frac{M \left[ 2 + (\gamma-1) M^2 \right]}{2(1-M^2)} \left[ - \left( \frac{2\alpha}{D_i + \alpha x} \right) + \left( \frac{1 + \gamma M^2}{2} \right) \left( \frac{\beta}{(T_t)_i + \beta x} \right) \right]
\]</div>
<p>and we can write a function that evaluates this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dMdx_heat_area</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">D_in</span><span class="p">,</span> <span class="n">Tt_in</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns dM/dx for nozzle with heat transfer and area change&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="mf">0.5</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">D_in</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> 
            <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">gamma</span><span class="o">*</span><span class="n">M</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">Tt_in</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We also need to handle the normal shock wave at the middle of the nozzle.
The shock is a discontinuity at <span class="math notranslate nohighlight">\(x = 0.5 L\)</span>, and so we can only integrate for <span class="math notranslate nohighlight">\(M(x)\)</span> from <span class="math notranslate nohighlight">\(x = [0, 0.5 L]\)</span> before we need to account for the shock by using our normal shock relationship. Then, using the new Mach number following the shock, we can continue the integration over <span class="math notranslate nohighlight">\( x = [0.5 L, L] \)</span>.</p>
<p>For comparison, we can also calculate the adiabatic flow solution, which is isentropic except for the normal shock.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normal_shock</span><span class="p">(</span><span class="n">mach</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns Mach number after normal shock wave&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="p">(</span><span class="n">mach</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">gamma</span><span class="o">*</span><span class="n">mach</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">gamma</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># problem parameters</span>
<span class="n">mach_in</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">1.4</span>

<span class="n">diam_in</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">diam_exit</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">Q_</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;cm&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="p">((</span><span class="n">diam_exit</span> <span class="o">-</span> <span class="n">diam_in</span><span class="p">)</span> <span class="o">/</span> <span class="n">length</span><span class="p">)</span><span class="o">.</span><span class="n">to_base_units</span><span class="p">()</span><span class="o">.</span><span class="n">magnitude</span>

<span class="c1"># shock location: x = 5 cm</span>
<span class="n">stag_temp_in</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># K/m</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first solve to shock over x = [0, 0.5 L]:</span>
<span class="n">sol_1</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_heat_area</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">mach_in</span><span class="p">],</span>
    <span class="n">max_step</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">diam_in</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">stag_temp_in</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># find the Mach number after the normal shock</span>
<span class="n">mach_post_shock</span> <span class="o">=</span> <span class="n">normal_shock</span><span class="p">(</span><span class="n">sol_1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">gamma</span><span class="p">)</span>

<span class="c1"># complete the integration over x = [0.5 L, L]:</span>
<span class="n">sol_2</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_heat_area</span><span class="p">,</span> <span class="p">[</span><span class="n">length</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">.</span><span class="n">magnitude</span><span class="p">],</span> <span class="p">[</span><span class="n">mach_post_shock</span><span class="p">],</span>
    <span class="n">max_step</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">diam_in</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">stag_temp_in</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adiabatic solution: isentropic except for the shock</span>
<span class="c1"># first solve to shock over x = [0, 0.5 L]:</span>
<span class="n">sol_1_adiabatic</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_heat_area</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">mach_in</span><span class="p">],</span>
    <span class="n">max_step</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam_in</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">stag_temp_in</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># find the Mach number after the normal shock</span>
<span class="n">mach_post_shock_adiabatic</span> <span class="o">=</span> <span class="n">normal_shock</span><span class="p">(</span><span class="n">sol_1_adiabatic</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">gamma</span><span class="p">)</span>

<span class="c1"># complete the integration over x = [0.5 L, L]:</span>
<span class="n">sol_2_adiabatic</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span>
    <span class="n">dMdx_heat_area</span><span class="p">,</span> <span class="p">[</span><span class="n">length</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">.</span><span class="n">magnitude</span><span class="p">],</span> <span class="p">[</span><span class="n">mach_post_shock_adiabatic</span><span class="p">],</span>
    <span class="n">max_step</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span>
    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">diam_in</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">stag_temp_in</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_1</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol_2</span><span class="o">.</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">sol_2</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])),</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;with heat transfer&#39;</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_1_adiabatic</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol_2_adiabatic</span><span class="o">.</span><span class="n">t</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> 
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">sol_1_adiabatic</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">sol_2_adiabatic</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])),</span>
    <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;adiabatic&#39;</span>
    <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x$ location (cm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mach number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#plt.savefig(&#39;heat-area.png&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exit Mach: </span><span class="si">{</span><span class="n">sol_2</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1"> .4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exit Mach (adiabatic): </span><span class="si">{</span><span class="n">sol_2_adiabatic</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1"> .4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/multiple-effects_35_0.png" src="../_images/multiple-effects_35_0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exit Mach:  0.1966
Exit Mach (adiabatic):  0.1931
</pre></div>
</div>
</div>
</div>
<p>We can see that in the supersonic region of the nozzle, the heat addition slightly decelerates the flow from isentropic, as we would expect in a supersonic Rayleigh flow, but the area change plays a much bigger role. Following the normal shock, the full solution tracks the adiabatic solution closely, but with a slightly higher exit Mach number.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./compressible-flows"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="heat-transfer.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Flows with heat transfer (Rayleigh flows)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../zbibliography.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bibliography</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Kyle Niemeyer<br/>
        
          <div class="extra_footer">
            <p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" class="license-text"><a rel="cc:attributionURL" property="dct:title" href="https://github.com/kyleniemeyer/gas-dynamics-notes">Gas Dynamics notes</a> by <span property="cc:attributionName">Kyle Niemeyer</span> is licensed under <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" /><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" /><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" /></a></p>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>